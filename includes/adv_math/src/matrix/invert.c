/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   invert.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: gpinchon <gpinchon@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2016/06/24 16:35:25 by gpinchon          #+#    #+#             */
/*   Updated: 2016/06/24 16:36:09 by gpinchon         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "../../adv_math.h"

static void	m4_inverse1(t_mat4 *t, const t_mat4 i)
{
	t->m[0] = i.m[5] * i.m[10] * i.m[15] - i.m[5] * i.m[11] * i.m[14] -
		i.m[9] * i.m[6] * i.m[15] + i.m[9] * i.m[7] * i.m[14] +
		i.m[13] * i.m[6] * i.m[11] - i.m[13] * i.m[7] * i.m[10];
	t->m[4] = -i.m[4] * i.m[10] * i.m[15] + i.m[4] * i.m[11] * i.m[14] +
		i.m[8] * i.m[6] * i.m[15] - i.m[8] * i.m[7] * i.m[14] -
		i.m[12] * i.m[6] * i.m[11] + i.m[12] * i.m[7] * i.m[10];
	t->m[8] = i.m[4] * i.m[9] * i.m[15] - i.m[4] * i.m[11] * i.m[13] -
		i.m[8] * i.m[5] * i.m[15] + i.m[8] * i.m[7] * i.m[13] +
		i.m[12] * i.m[5] * i.m[11] - i.m[12] * i.m[7] * i.m[9];
	t->m[12] = -i.m[4] * i.m[9] * i.m[14] + i.m[4] * i.m[10] * i.m[13] +
		i.m[8] * i.m[5] * i.m[14] - i.m[8] * i.m[6] * i.m[13] -
		i.m[12] * i.m[5] * i.m[10] + i.m[12] * i.m[6] * i.m[9];
	t->m[1] = -i.m[1] * i.m[10] * i.m[15] + i.m[1] * i.m[11] * i.m[14] +
		i.m[9] * i.m[2] * i.m[15] - i.m[9] * i.m[3] * i.m[14] -
		i.m[13] * i.m[2] * i.m[11] + i.m[13] * i.m[3] * i.m[10];
	t->m[5] = i.m[0] * i.m[10] * i.m[15] - i.m[0] * i.m[11] * i.m[14] -
		i.m[8] * i.m[2] * i.m[15] + i.m[8] * i.m[3] * i.m[14] +
		i.m[12] * i.m[2] * i.m[11] - i.m[12] * i.m[3] * i.m[10];
	t->m[9] = -i.m[0] * i.m[9] * i.m[15] + i.m[0] * i.m[11] * i.m[13] +
		i.m[8] * i.m[1] * i.m[15] - i.m[8] * i.m[3] * i.m[13] -
		i.m[12] * i.m[1] * i.m[11] + i.m[12] * i.m[3] * i.m[9];
	t->m[13] = i.m[0] * i.m[9] * i.m[14] - i.m[0] * i.m[10] * i.m[13] -
		i.m[8] * i.m[1] * i.m[14] + i.m[8] * i.m[2] * i.m[13] +
		i.m[12] * i.m[1] * i.m[10] - i.m[12] * i.m[2] * i.m[9];
}

static void	m4_inverse2(t_mat4 *t, const t_mat4 i)
{
	t->m[2] = i.m[1] * i.m[6] * i.m[15] - i.m[1] * i.m[7] * i.m[14] -
		i.m[5] * i.m[2] * i.m[15] + i.m[5] * i.m[3] * i.m[14] +
		i.m[13] * i.m[2] * i.m[7] - i.m[13] * i.m[3] * i.m[6];
	t->m[6] = -i.m[0] * i.m[6] * i.m[15] + i.m[0] * i.m[7] * i.m[14] +
		i.m[4] * i.m[2] * i.m[15] - i.m[4] * i.m[3] * i.m[14] -
		i.m[12] * i.m[2] * i.m[7] + i.m[12] * i.m[3] * i.m[6];
	t->m[10] = i.m[0] * i.m[5] * i.m[15] - i.m[0] * i.m[7] * i.m[13] -
		i.m[4] * i.m[1] * i.m[15] + i.m[4] * i.m[3] * i.m[13] +
		i.m[12] * i.m[1] * i.m[7] - i.m[12] * i.m[3] * i.m[5];
	t->m[14] = -i.m[0] * i.m[5] * i.m[14] + i.m[0] * i.m[6] * i.m[13] +
		i.m[4] * i.m[1] * i.m[14] - i.m[4] * i.m[2] * i.m[13] -
		i.m[12] * i.m[1] * i.m[6] + i.m[12] * i.m[2] * i.m[5];
	t->m[3] = -i.m[1] * i.m[6] * i.m[11] + i.m[1] * i.m[7] * i.m[10] +
		i.m[5] * i.m[2] * i.m[11] - i.m[5] * i.m[3] * i.m[10] -
		i.m[9] * i.m[2] * i.m[7] + i.m[9] * i.m[3] * i.m[6];
	t->m[7] = i.m[0] * i.m[6] * i.m[11] - i.m[0] * i.m[7] * i.m[10] -
		i.m[4] * i.m[2] * i.m[11] + i.m[4] * i.m[3] * i.m[10] +
		i.m[8] * i.m[2] * i.m[7] - i.m[8] * i.m[3] * i.m[6];
	t->m[11] = -i.m[0] * i.m[5] * i.m[11] + i.m[0] * i.m[7] * i.m[9] +
		i.m[4] * i.m[1] * i.m[11] - i.m[4] * i.m[3] * i.m[9] -
		i.m[8] * i.m[1] * i.m[7] + i.m[8] * i.m[3] * i.m[5];
	t->m[15] = i.m[0] * i.m[5] * i.m[10] - i.m[0] * i.m[6] * i.m[9] -
		i.m[4] * i.m[1] * i.m[10] + i.m[4] * i.m[2] * i.m[9] +
		i.m[8] * i.m[1] * i.m[6] - i.m[8] * i.m[2] * i.m[5];
}

t_mat4		m4_invert(const t_mat4 i)
{
	t_mat4	t;
	float	det;
	int		j;

	m4_inverse1(&t, i);
	m4_inverse2(&t, i);
	det = i.m[0] * t.m[0] + i.m[1] * t.m[4] +
	i.m[2] * t.m[8] + i.m[3] * t.m[12];
	if (det == 0)
		return (m4_zero());
	det = 1.0 / det;
	j = 0;
	while (j < 16)
	{
		t.m[j] = t.m[j] * det;
		j++;
	}
	return (t);
}
